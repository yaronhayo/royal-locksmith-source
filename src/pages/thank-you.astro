---
/**
 * Thank You Page
 * 
 * Confirmation page shown after form submissions with:
 * - Dynamic content based on form type
 * - Next steps information
 * - Related links
 * - No-index to prevent search indexing
 * - Access protection (only accessible after form submission)
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/common/Header.astro';
import Footer from '../components/common/Footer.astro';
import { Section, Badge, Card, CardContent } from '../components/ui';
import { Icon } from 'astro-icon/components';
import { siteConfig } from '../config/site.config';

// Get form type from URL params
const url = new URL(Astro.request.url);
const formType = url.searchParams.get('type') || 'contact';

// Content based on form type
const content = {
  contact: {
    title: 'Message Received!',
    subtitle: 'Thank you for contacting us',
    message: 'We\'ve received your message and will get back to you as soon as possible. Our team typically responds within 24 hours.',
    icon: 'lucide:mail-check',
  },
  booking: {
    title: 'Booking Request Submitted!',
    subtitle: 'Thank you for scheduling with us',
    message: 'We\'ve received your booking request. Our team will contact you shortly to confirm your appointment and discuss any specific requirements.',
    icon: 'lucide:calendar-check',
  },
  quote: {
    title: 'Quote Request Received!',
    subtitle: 'Thank you for your interest',
    message: 'We\'ve received your quote request. A member of our team will review your requirements and get back to you with a detailed estimate.',
    icon: 'lucide:file-check',
  },
};

const pageContent = content[formType as keyof typeof content] || content.contact;

const nextSteps = [
  {
    icon: 'lucide:phone-incoming',
    title: 'Expect Our Call',
    description: 'Our team will reach out to confirm details and answer any questions you may have.',
  },
  {
    icon: 'lucide:clipboard-check',
    title: 'Free Assessment',
    description: 'A licensed technician will assess your needs and provide a detailed, no-obligation estimate.',
  },
  {
    icon: 'lucide:thumbs-up',
    title: 'Your Approval',
    description: 'Once you approve the estimate, we\'ll proceed with the service at your convenience.',
  },
];
---

<BaseLayout
  title={pageContent.title}
  description="Thank you for contacting us. We've received your submission and will be in touch soon."
  noindex={true}
>
  <!-- Access Protection Script - Redirect if no form was submitted -->
  <script is:inline>
    (function() {
      // Check if form was submitted (set by the form on successful submission)
      const formSubmitted = sessionStorage.getItem('form_submitted');
      
      if (!formSubmitted) {
        // No form submitted, redirect to homepage
        window.location.replace('/');
        return;
      }
      
      // Clear the flag so page can't be accessed on refresh
      sessionStorage.removeItem('form_submitted');
    })();
  </script>

  <Header slot="header" />

  <!-- Hero Section -->
  <section class="relative overflow-hidden bg-gradient-to-br from-success-50 via-background to-primary-50 dark:from-success-950 dark:via-background dark:to-primary-950">
    <div class="container-custom py-20 lg:py-32">
      <div class="mx-auto max-w-3xl text-center">
        <!-- Success Icon -->
        <div class="mx-auto mb-8 flex h-24 w-24 items-center justify-center rounded-full bg-success-100 dark:bg-success-900/30">
          <Icon name={pageContent.icon} class="h-12 w-12 text-success-600 dark:text-success-400" />
        </div>
        
        <Badge client:load variant="primary" size="lg" className="mb-4">
          <Icon name="lucide:check-circle" class="mr-2 h-4 w-4" />
          {pageContent.subtitle}
        </Badge>
        
        <h1 class="font-display text-3xl font-bold tracking-tight text-foreground sm:text-4xl lg:text-5xl">
          {pageContent.title}
        </h1>
        
        <p class="mx-auto mt-6 max-w-2xl text-lg text-muted-foreground lg:text-xl">
          {pageContent.message}
        </p>
        
        <!-- Contact Info -->
        <div class="mt-8 inline-flex items-center gap-4 rounded-2xl border border-border bg-card px-6 py-4 shadow-sm">
          <div class="flex items-center gap-2 text-muted-foreground">
            <Icon name="lucide:clock" class="h-5 w-5" />
            <span>Response within 24 hours</span>
          </div>
          <div class="h-6 w-px bg-border"></div>
          <a
            href={`tel:${siteConfig.contact.phone.href}`}
            class="flex items-center gap-2 font-medium text-primary hover:underline"
          >
            <Icon name="lucide:phone" class="h-5 w-5" />
            {siteConfig.contact.phone.display}
          </a>
        </div>
      </div>
    </div>
    
    <!-- Decorative elements -->
    <div class="absolute -bottom-24 -right-24 h-96 w-96 rounded-full bg-success/10 blur-3xl"></div>
    <div class="absolute -top-24 -left-24 h-96 w-96 rounded-full bg-primary/5 blur-3xl"></div>
  </section>

  <!-- What Happens Next -->
  <Section client:load size="lg" background="muted">
    <div class="mx-auto max-w-3xl text-center">
      <h2 class="text-2xl font-bold tracking-tight sm:text-3xl">
        What Happens Next?
      </h2>
      <p class="mt-4 text-muted-foreground">
        Here's what you can expect after submitting your request.
      </p>
    </div>
    
    <div class="mx-auto mt-12 max-w-4xl">
      <div class="grid gap-6 md:grid-cols-3">
        {nextSteps.map((step, index) => (
          <div class="relative">
            {/* Connector line */}
            {index < nextSteps.length - 1 && (
              <div class="absolute left-1/2 top-16 hidden h-px w-full bg-border md:block"></div>
            )}
            
            <Card client:load padding="lg" className="relative z-10 text-center">
              <CardContent>
                <div class="mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-primary text-primary-foreground">
                  <Icon name={step.icon} class="h-7 w-7" />
                </div>
                <h3 class="text-lg font-semibold">{step.title}</h3>
                <p class="mt-2 text-sm text-muted-foreground">{step.description}</p>
              </CardContent>
            </Card>
          </div>
        ))}
      </div>
    </div>
  </Section>

  <!-- Helpful Links -->
  <Section client:load size="lg" background="default">
    <div class="mx-auto max-w-3xl text-center">
      <h2 class="text-2xl font-bold tracking-tight sm:text-3xl">
        While You Wait
      </h2>
      <p class="mt-4 text-muted-foreground">
        Explore more about our services and company.
      </p>
    </div>
    
    <div class="mx-auto mt-12 grid max-w-4xl gap-6 sm:grid-cols-2 lg:grid-cols-4">
      {[
        { href: '/services/', icon: 'lucide:wrench', label: 'Our Services' },
        { href: '/locations/', icon: 'lucide:map-pin', label: 'Service Areas' },
        { href: '/faq/', icon: 'lucide:help-circle', label: 'FAQ' },
        { href: '/about/', icon: 'lucide:users', label: 'About Us' },
      ].map((link) => (
        <a
          href={link.href}
          class="flex flex-col items-center gap-3 rounded-xl border border-border bg-card p-6 transition-all hover:border-primary hover:shadow-lg"
        >
          <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-primary/10 text-primary">
            <Icon name={link.icon} class="h-6 w-6" />
          </div>
          <span class="font-medium">{link.label}</span>
        </a>
      ))}
    </div>
  </Section>

  <!-- Return Home CTA -->
  <Section client:load size="md" background="muted">
    <div class="text-center">
      <a
        href="/"
        class="inline-flex items-center gap-2 rounded-xl bg-primary px-8 py-4 font-semibold text-primary-foreground transition-colors hover:bg-primary/90"
      >
        <Icon name="lucide:home" class="h-5 w-5" />
        Return to Homepage
      </a>
    </div>
  </Section>

  <Footer slot="footer" />
</BaseLayout>
