---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/common/Header.astro';
import Footer from '../../components/common/Footer.astro';
import Schema from '../../components/common/Schema.astro';
import Breadcrumbs from '../../components/common/Breadcrumbs.astro';
import { Section, Button, Card, CardContent, Badge } from '../../components/ui';
import { Icon } from 'astro-icon/components';
import { siteConfig } from '../../config/site.config';
import { getServiceImage } from '../../config/image-registry';
import { getLocalBusinessSchema } from '../../utils/schema';

const services = await getCollection('services', ({ data }) => !data.draft);
const sortedServices = services.sort((a, b) => (a.data.order || 99) - (b.data.order || 99));

const schemas = [getLocalBusinessSchema()];

const breadcrumbItems = [
  { label: 'Services', href: '/services/' },
];

const serviceIcons: Record<string, string> = {
  home: 'lucide:home',
  building: 'lucide:building-2',
  car: 'lucide:car',
  'alert-circle': 'lucide:siren',
};
---

<BaseLayout
  title="NJ Locksmith Services | Residential & Commercial"
  description={`Professional locksmith services including residential, commercial, automotive, and emergency solutions in ${siteConfig.serviceArea.region}. Licensed, insured, and available 24/7.`}
  ogImage="/images/produced/hero-home.png"
>
  <Schema slot="head" schema={schemas} />
  <Header slot="header" />

  <!-- Hero Section -->
  <section class="relative overflow-hidden bg-gradient-to-br from-primary-50 via-background to-accent-50 dark:from-primary-950 dark:via-background dark:to-accent-950">
    <div class="container-custom py-16 lg:py-24">
      <Breadcrumbs items={breadcrumbItems} className="mb-6" />
      
      <div class="mx-auto max-w-4xl text-center">
        <Badge client:load variant="primary" size="lg" className="mb-4">
          {siteConfig.name}
        </Badge>
        
        <h1 class="font-display text-3xl font-bold tracking-tight text-foreground sm:text-4xl lg:text-5xl">
          Professional Locksmith Services in NJ
        </h1>
        
        <p class="mx-auto mt-6 max-w-2xl text-lg text-muted-foreground lg:text-xl">
          Comprehensive security solutions for residential, commercial, and automotive needs. Our licensed technicians provide expert service throughout {siteConfig.serviceArea.region}.
        </p>
      </div>
    </div>
  </section>

  <!-- Services Grid -->
  <Section client:load size="lg" background="default">
    <div class="grid gap-8 md:grid-cols-2">
      {sortedServices.map((service) => (
        <a href={`/services/${service.slug}/`} class="group h-full">
          <Card client:load variant="hover" padding="none" className="h-full overflow-hidden flex flex-col">
            <!-- Service Image Area -->
            <div class="relative aspect-[21/9] overflow-hidden bg-muted sm:aspect-[16/9] md:aspect-[21/9]">
              <img 
                src={getServiceImage(service.slug).hero} 
                alt={service.data.title}
                class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
                loading="lazy"
                transition:name={`service-image-${service.slug}`}
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-60"></div>
              
              <!-- Icon/Badge Overlay -->
              <div class="absolute bottom-4 left-4 flex items-center gap-3">
                <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-lg">
                  <Icon name={serviceIcons[service.data.icon || 'home'] || 'lucide:key'} class="h-6 w-6" />
                </div>
                <Badge client:load variant="secondary" className="backdrop-blur-sm bg-white/10 text-white border-white/20">
                  {service.data.category || 'Service'}
                </Badge>
              </div>
            </div>

            <CardContent className="flex-1 p-6 lg:p-8">
              <h2 class="text-2xl font-bold group-hover:text-primary transition-colors">
                {service.data.title}
              </h2>
              <p class="mt-3 text-muted-foreground leading-relaxed line-clamp-2">
                {service.data.shortDescription || service.data.description}
              </p>
              
              {service.data.features && service.data.features.length > 0 && (
                <div class="mt-6 flex flex-wrap gap-2">
                  {service.data.features.slice(0, 3).map((feature) => (
                    <span class="inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-medium text-muted-foreground border border-border">
                      {feature}
                    </span>
                  ))}
                </div>
              )}
              
              <div class="mt-8 flex items-center gap-2 font-semibold text-primary">
                View Service Options
                <Icon name="lucide:arrow-right" class="h-4 w-4 transition-transform group-hover:translate-x-1" />
              </div>
            </CardContent>
          </Card>
        </a>
      ))}
    </div>
  </Section>

  <!-- CTA Section -->
  <Section client:load size="lg" background="primary" className="text-center">
    <h2 class="text-3xl font-bold tracking-tight text-primary-foreground sm:text-4xl">
      Need Professional Locksmith Services?
    </h2>
    <p class="mx-auto mt-4 max-w-2xl text-primary-foreground/80">
      Contact us today for a free on-site inspection and estimate. Our expert technicians are ready to help with all your security needs.
    </p>
    <div class="mt-8 flex flex-col items-center justify-center gap-4 sm:flex-row">
      <Button client:load variant="secondary" size="lg" className="gap-2">
        <Icon name="lucide:phone" class="h-5 w-5" />
        Call {siteConfig.contact.phone.display}
      </Button>
      <Button client:load variant="outline" size="lg" className="border-primary-foreground/20 text-primary-foreground hover:bg-primary-foreground/10 gap-2">
        <Icon name="lucide:file-text" class="h-5 w-5" />
        Get Free Estimate
      </Button>
    </div>
  </Section>

  <Footer slot="footer" />
</BaseLayout>
